<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 元数据 -->
    <meta charset="utf-8">

    <link rel="icon" href="/assets/favicon.png">


    <title>奇点科普科幻协会</title>
    <link rel="canonical" href="https://qidian.space/index.html">
    <meta name="author" content="奇点科普科幻协会" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="robots" content="index,follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="format-detection" content="telphone=no, email=no" />

    <meta name="keywords" content="科普,科幻,社团" />

    <meta name="description" content="奇点科普科幻协会官方博客 分享科学知识、科幻作品与创作心得。">
    <meta property="og:type" content="website">
    <meta property="og:title" content="奇点科普科幻协会">
    <meta property="og:url" content="https://qidian.space/index.html">
    <meta property="og:site_name" content="奇点科普科幻协会">
    <meta property="og:description" content="奇点科普科幻协会官方博客 分享科学知识、科幻作品与创作心得。">
    <meta property="og:locale" content="zh_CN">
    <meta property="article:author" content="奇点科普科幻协会">
    <meta property="article:tag" content="社团">
    <meta property="article:tag" content="科幻">
    <meta property="article:tag" content="科普">
    <meta name="twitter:card" content="summary">

    <link rel="alternate" href="/atom.xml" title="奇点科普科幻协会" type="application/atom+xml">

    <!-- 样式表文件 -->
    <link rel="stylesheet" id="kratos-css" href="/css/kr-core.min.css" media="all"></link>

    <link rel="stylesheet" id="highlight-css" href="/css/highlight/highlight.js/night-eighties.min.css" media="all"></link>

    <link rel="stylesheet" id="theme-light-css" href="/css/kr-theme/light.min.css" media="all"></link>
    <link rel="stylesheet" id="theme-dark-css" href="/css/kr-theme/dark.min.css" media="(prefers-color-scheme: dark)"></link>
    <script src="/js/kr-theme.min.js"></script>
    <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></link>

    <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></link>


    <link rel="stylesheet" href="/vendors/viewerjs@1.11.6/dist/viewer.min.css"></link>

    <!-- 不得不预先加载的一些JS文件 -->

    <script src="/vendors/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>

    <!-- 自定义站点横幅和背景 -->
    <style>
        .kratos-cover.kratos-cover-2 {
            background-image: url('/assets/banner.webp');
        }
        html[data-theme="dark"] .kratos-cover.kratos-cover-2 {
            background-image: url('/assets/banner_dark.webp');
        }


        @media(min-width:768px) {
            body.custom-background {
                background-image: url('/assets/bg.webp');
            }
            html[data-theme="dark"] body.custom-background {
                background-image: url('/assets/bg.webp');
            }
        }


        .widget-kratos-about .photo-background {
            background-image: url('/images/default.webp');
        }
        html[data-theme="dark"] .widget-kratos-about .photo-background {
            background-image: url('/images/default.webp');
        }

    </style>

    <!-- 额外的追加注入项 -->

    <meta name="generator" content="Hexo 8.0.0"></head>

<body class="custom-background">
<div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">

                                <li>

                                    <a href="/">


                                        <i class="fa fa-home"></i>

                                        首页
                                    </a>

                                </li>

                                <li>

                                    <a href="/archives/">


                                        <i class="fa fa-file"></i>

                                        档案
                                    </a>

                                </li>

                                <li>

                                    <a href="/frinds-links/">


                                        <i class="fa fa-link"></i>

                                        友链
                                    </a>

                                </li>

                                <li>

                                    <a href="/search/">


                                        <i class="fa fa-search"></i>

                                        搜索
                                    </a>

                                </li>

                                <li>

                                    <a href="/contribute/">


                                        <i class="fa fa-pencil"></i>

                                        投稿
                                    </a>

                                </li>

                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">奇点科普科幻协会</a></div>
                    <div id="kratos-nav-toggle-wrapper" class="nav-toggle">
                        <a id="kratos-nav-toggle" class="kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>奇点科普科幻协会</h2> <br />
                        <span>探索科学与幻想的边界</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    <div id="app" class="contribute-page">

                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div id="footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 col-md-offset-3 footer-list text-center">
                            <ul class="kratos-social-icons">

                                <li>
                                    <a href="https://github.com/qidiankepukehuan/qidiankepukehuan" target="_blank" rel="nofollow">
                                        <i class="fa fa-github"></i>
                                    </a>
                                </li>

                                <li>
                                    <a href="/atom.xml" target="_blank" rel="nofollow">
                                        <i class="fa fa-rss"></i>
                                    </a>
                                </li>

                            </ul>
                            <ul class="kratos-copyright">
                                <div>
                                    <li>&copy; 2025 奇点科普科幻协会 版权所有.</li>
                                    <li>本协会已在风雨中飘摇<span id="kr-since">Loading...</span></li>
                                </div>
                                <div>
                                    <li>使用hexo <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a> 主题</li>
                                    <li>站点由 <a href="https://github.com/qidiankepukehuan" target="_blank">奇点科普科幻协会</a> 用 <i class="fa fa-heart" style="color:#d43f57"></i> 搭建</li>
                                </div>
                                <!-- 额外的追加注入项 -->

                                <div>

                                    <li>本网站所有内容著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</li>

                                </div>

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="kr-tool text-center">
                    <div class="tool">

                        <div class="box search-box">
                            <a href="/search">
                                <span class="fa fa-search"></span>
                            </a>
                        </div>

                        <div class="box theme-box" id="theme-toggle">
                            <span class="fa fa-adjust"></span>
                        </div>
                    </div>
                    <div id="gotop-box" class="box gotop-box">
                        <span class="fa fa-chevron-up"></span>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>




<div id="kr-share-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseShareModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-share-alt"></i>
            </div>
            <div class="kr-modal-title">分享这一刻</div>
            <button class="kr-modal-close" onclick="krCloseShareModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-share-message">让朋友们也来瞅瞅！</div>
            <div class="kr-share-qr" id="kr-share-qr"></div>
            <div class="kr-share-platforms">

                <button class="kr-share-platform-button" style="color: #00B2FF;" title="QQ" onclick="krShareModalOpenPlatform('https://connect.qq.com/widget/shareqq/index.html?url=$URL&title=$TITLE&desc=&summary=$SUMMARY&site=$SITE')">
                    <svg t="1753712326357" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4511" width="200" height="200"><path d="M824.8 613.2c-16-51.4-34.4-94.6-62.7-165.3C766.5 262.2 689.3 112 511.5 112 331.7 112 256.2 265.2 261 447.9c-28.4 70.8-46.7 113.7-62.7 165.3-34 109.5-23 154.8-14.6 155.8 18 2.2 70.1-82.4 70.1-82.4 0 49 25.2 112.9 79.8 159-26.4 8.1-85.7 29.9-71.6 53.8 11.4 19.3 196.2 12.3 249.5 6.3 53.3 6 238.1 13 249.5-6.3 14.1-23.8-45.3-45.7-71.6-53.8 54.6-46.2 79.8-110.1 79.8-159 0 0 52.1 84.6 70.1 82.4 8.5-1.1 19.5-46.4-14.5-155.8z" p-id="4512" fill="#1296db"></path></svg>
                </button>

                <button class="kr-share-platform-button" style="color: #FF0000;" title="微博" onclick="krShareModalOpenPlatform('https://service.weibo.com/share/share.php?url=$URL&title=$TITLE')">
                    <svg t="1753712727959" class="icon" viewBox="0 0 1138 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5661" width="200" height="200"><path d="M914.432 518.144q27.648 21.504 38.912 51.712t9.216 62.976-14.336 65.536-31.744 59.392q-34.816 48.128-78.848 81.92t-91.136 56.32-94.72 35.328-89.6 18.944-75.264 7.68-51.712 1.536-49.152-2.56-68.096-10.24-78.336-21.504-79.872-36.352-74.24-55.296-59.904-78.848q-16.384-29.696-22.016-63.488t-5.632-86.016q0-22.528 7.68-51.2t27.136-63.488 53.248-75.776 86.016-90.112q51.2-48.128 105.984-85.504t117.248-57.856q28.672-10.24 63.488-11.264t57.344 11.264q10.24 11.264 19.456 23.04t12.288 29.184q3.072 14.336 0.512 27.648t-5.632 26.624-5.12 25.6 2.048 22.528q17.408 2.048 33.792-1.536t31.744-9.216 31.232-11.776 33.28-9.216q27.648-5.12 54.784-4.608t49.152 7.68 36.352 22.016 17.408 38.4q2.048 14.336-2.048 26.624t-8.704 23.04-7.168 22.016 1.536 23.552q3.072 7.168 14.848 13.312t27.136 12.288 32.256 13.312 29.184 16.384zM656.384 836.608q26.624-16.384 53.76-45.056t44.032-64 18.944-75.776-20.48-81.408q-19.456-33.792-47.616-57.344t-62.976-37.376-74.24-19.968-80.384-6.144q-78.848 0-139.776 16.384t-105.472 43.008-72.192 60.416-38.912 68.608q-11.264 33.792-6.656 67.072t20.992 62.976 42.496 53.248 57.856 37.888q58.368 25.6 119.296 32.256t116.224 0.512 100.864-21.504 74.24-33.792zM522.24 513.024q20.48 8.192 38.912 18.432t32.768 27.648q10.24 12.288 17.92 30.72t10.752 39.424 1.536 42.496-9.728 38.912q-8.192 18.432-19.968 37.376t-28.672 35.328-40.448 29.184-57.344 18.944q-61.44 11.264-117.76-11.264t-88.064-74.752q-12.288-39.936-13.312-70.656t16.384-66.56q13.312-27.648 40.448-51.712t62.464-38.912 75.264-17.408 78.848 12.8zM359.424 764.928q37.888 3.072 57.856-18.432t21.504-48.128-15.36-47.616-52.736-16.896q-27.648 3.072-43.008 23.552t-17.408 43.52 9.728 42.496 39.424 21.504zM778.24 6.144q74.752 0 139.776 19.968t113.664 57.856 76.288 92.16 27.648 122.88q0 33.792-16.384 50.688t-35.328 17.408-35.328-14.336-16.384-45.568q0-40.96-22.528-77.824t-59.392-64.512-84.48-43.52-96.768-15.872q-31.744 0-47.104-15.36t-14.336-34.304 18.944-34.304 51.712-15.36zM778.24 169.984q95.232 0 144.384 48.64t49.152 146.944q0 30.72-10.24 43.52t-22.528 11.264-22.528-14.848-10.24-35.84q0-60.416-34.816-96.256t-93.184-35.84q-19.456 0-28.672-10.752t-9.216-23.04 9.728-23.04 28.16-10.752z" p-id="5662" fill="#d81e06"></path></svg>
                </button>

                <button class="kr-share-platform-button" style="color: #FFF200;" title="QQ空间" onclick="krShareModalOpenPlatform('https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=$URL&title=$TITLE&desc=&summary=$SUMMARY&site=$SITE')">
                    <svg t="1753712814051" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6729" width="200" height="200"><path d="M955.728 428.224c8.385-8.785 3.76-23.536-8.073-25.753l-276.832-51.854c-4.838-0.906-9.02-3.987-11.38-8.383L525.873 93.229c-2.798-5.23-8.342-7.85-13.875-7.896-5.532 0.045-11.075 2.667-13.873 7.896L364.558 342.234c-2.36 4.396-6.543 7.477-11.381 8.383L76.345 402.471c-11.833 2.217-16.458 16.968-8.073 25.753L269.64 639.086c3.564 3.733 5.205 8.952 4.433 14.1l-46.015 282.032c-1.819 12.126 10.394 21.407 21.298 16.182L505 827.827a16.098 16.098 0 0 1 7-1.58 16.1 16.1 0 0 1 7.003 1.58L774.644 951.4c10.904 5.225 23.117-4.056 21.298-16.182l-46.88-287.298 206.666-219.696z" fill="#FFCD00" p-id="6730"></path><path d="M559.42 493.63c-4.517-3.772-110.987-40.332-273.968-16-3.16 0.47-5.913-0.394-8.04-1.992-0.717 4 3.587 7.152 8.988 7.527 115.064 8.021 179.42 54.987 199.492 71.501 40.78-28.923 71.882-50.606 73.063-51.527 3.668-2.856 3.695-6.811 0.465-9.51m135.65-29.972c-41.744 35.168-160.159 116.897-201.52 148.468-4.864 3.711-3.177 9.424 2.098 11.43 17.045 6.488 36.23 11.95 56.421 16.445l159.784-152.228c12.544-13.184 5.238-29.152-10.422-32.661-1.025 3.011-3.259 5.933-6.36 8.546M817.187 640l-0.101 0.045c-70.456 29.709-241.54 79.623-451.762 72.33-25.386-0.88-50.63-3.715-64.786-6.325-2.067-0.38-3.878-1.012-5.476-1.846-10.567 12.224 2.073 21.462 47.148 30.58 131.886 26.676 286.047 38.934 415.304 30.665l-8.884-54.324c43.727-31.431 64.996-58.546 67.524-62.57 2.899-4.616 1.033-8.555 1.033-8.555" fill="#F1A308" p-id="6731"></path><path d="M818.863 646.995c-53.31 5.137-215.894 3.686-311.826-33.167-5.107-1.962-6.834-7.566-2.129-11.194 40.025-30.84 154.62-110.68 195.014-145.035 7.872-6.696 9.95-15.437 0.375-22.542-18.36-13.623-83.168-36.203-158.198-36.816-107.373-0.88-212.858 29.498-259.133 54.09-10.983 5.837-4.392 21.221 6.83 19.495 164.223-25.24 271.495 12.756 276.045 16.67 3.255 2.798 3.074 6.906-0.5 9.715-3.036 2.389-199.263 143.36-258.23 193.11-9.286 7.834-6.845 24.246 8.35 27.018 14.152 2.582 39.406 5.412 64.784 6.284 210.173 7.214 381.314-42.24 451.755-71.63 0 0-2.148-7.057-13.137-5.998" fill="#FFFFFF" p-id="6732"></path></svg>
                </button>

            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/share.min.js"></script>



<!-- 额外的追加注入项 -->


<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


<script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>



<script defer src="/vendors/viewerjs@1.11.6/dist/viewer.min.js"></script>


<script defer src="/js/kr-core.min.js"></script>


<script defer src="/js/kr-pjax.min.js"></script>


<!-- 额外的追加注入项 -->

<script type="module" src="/comments/giscus.js"></script>
<script type="module" src="/utils/random-post-cover.js"></script>
<script src="/effects/cursor-effects.js"></script>
<script src="https://cdn.jsdelivr.net/gh/qidiankepukehuan/live2d-models@1.0.3/dist/autoload.js"></script>

<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>

<script type="text/babel">
    const backend_url = "https://contribute.qidian.space"
    const { useState, useEffect, useRef } = React;

    function ShadowApp() {
        const hostRef = useRef();

        useEffect(() => {
            const shadow = hostRef.current.attachShadow({ mode: "open" });

            // 创建样式节点
            // 1. 引入外部 CSS
            const linkBootstrap = document.createElement('link');
            linkBootstrap.rel = 'stylesheet';
            linkBootstrap.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
            shadow.appendChild(linkBootstrap);

            const linkToastUI = document.createElement('link');
            linkToastUI.rel = 'stylesheet';
            linkToastUI.href = 'https://uicdn.toast.com/editor/latest/toastui-editor.min.css';
            shadow.appendChild(linkToastUI);

            // 2. 自定义样式
            const styleCustom = document.createElement('style');
            styleCustom.textContent = `
                .main-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
                .guide, .card-section { padding: 15px; background: #fff; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; }
                .tag { display: inline-flex; align-items: center; margin: 3px; padding: 4px 8px; background: #51aded; color: #fff; border-radius: 5px; font-size: 0.9rem; }
                .tag .remove { margin-left: 6px; cursor: pointer; font-weight: bold; color: #fff; }
                .tag .remove:hover { color: #ffdddd; }
                .preview-img { max-width: 120px; margin: 5px; display: inline-block; text-align: center; background: #f8f9fa; padding: 5px; border-radius: 5px; }
                .preview-img img { max-width: 100%; border-radius: 4px; }
                .img-btns { display: flex; justify-content: space-between; margin-top: 5px; }
                .email-group { display: flex; gap: 5px; margin-bottom: 5px; }
                .email-group input { flex: 1; }
                .btn-sm { font-size: 0.8rem; padding: 0.25rem 0.5rem; }
                .custom-border {
                    border: 1px solid #CECECE; /* Bootstrap 主色调 */
                    border-radius: 5px;
                    transition: border-color 0.3s ease;
                }
                .blue-border {
                    border: 1px solid #0d6efd;
                    border-radius: 5px;
                }
                .red-border {
                    border: 1px solid #dc3545;
                    border-radius: 5px;
                }
            `;
            shadow.appendChild(styleCustom);

            // 创建 React 容器
            const container = document.createElement("div");
            shadow.appendChild(container);

            // 定义 App 内部组件
            function App() {
                const [title, setTitle] = useState("");
                const [author, setAuthor] = useState("");
                const [email, setEmail] = useState("");
                const [emailCode, setEmailCode] = useState("");
                const [tags, setTags] = useState([]);
                const [cover, setCover] = useState(null);
                const [images, setImages] = useState([]);
                const editorRef = useRef(null);

                useEffect(() => {
                    const editor = new toastui.Editor({
                        el: container.querySelector('#editor'),
                        height: '400px',
                        initialEditType: 'markdown',
                        previewStyle: 'vertical',
                        initialValue: '# 请输入正文'
                    });
                    editorRef.current = editor;
                }, []);

                // 文件转 base64
                function fileToBase64(file) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result.split(",")[1]); // 去掉 data:image/...;base64,
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                }

                async function toWebp(file) {
                    const options = { fileType: "image/webp", maxWidthOrHeight: 1920, initialQuality: 0.8 };
                    return await imageCompression(file, options);
                }

                async function handleCoverChange(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const webpFile = await toWebp(file);
                    const base64 = await fileToBase64(webpFile);
                    setCover({ name: "cover.webp", base64 });
                }

                async function handleImagesChange(e) {
                    const files = Array.from(e.target.files);
                    const result = [];

                    // 已有图片数量，继续往后排
                    let startIndex = images.length + 1;

                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const webpFile = await toWebp(file);
                        const base64 = await fileToBase64(webpFile);
                        const name = `${startIndex + i}.webp`; // 用序号命名
                        result.push({ name, base64 });
                    }

                    // 合并后，重新按名字中的数字排序
                    const newImages = [...images, ...result].sort((a, b) => {
                        const numA = parseInt(a.name);
                        const numB = parseInt(b.name);
                        return numA - numB;
                    });

                    setImages(newImages);
                }

                function insertImage(name) {
                    const path = `./posts/${title || "未命名文章"}/${name}`;
                    editorRef.current.insertText(`![${"请输入图注"}](${path})\n`);
                }

                function removeImage(name) {
                    setImages(images.filter(img => img.name !== name));
                }

                function handleTagKeyDown(e) {
                    if (e.key === "Enter") {
                        e.preventDefault();
                        const value = e.target.value.trim();
                        if (value) {
                            setTags([...tags, value]);
                            e.target.value = "";
                        }
                    }
                }

                function removeTag(tag) {
                    setTags(tags.filter(t => t !== tag));
                }

                async function sendEmailCode() {
                    try {
                        const res = await fetch(`${backend_url}/auth/send`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ email }),
                        });
                        if (res.ok) {
                            alert("验证码已发送！");
                        } else {
                            const text = await res.text();
                            alert("发送失败: " + text);
                        }
                    } catch (err) {
                        console.error(err);
                        alert("网络请求失败，请检查连接或稍后重试。");
                    }
                }

                async function handleSubmit() {
                    const content = editorRef.current.getMarkdown();
                    const payload = {
                        title,
                        author,
                        email,
                        email_code: emailCode,  // 注意这里字段名要和后端 SubmissionRequest 对应
                        tags,
                        cover,
                        images,
                        content,
                    };

                    console.log(payload);

                    try {
                        const res = await fetch(`${backend_url}/submit`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(payload),
                        });

                        if (res.ok) {
                            alert("投稿成功！");
                            // 提交成功后可以清空表单
                            setTitle("");
                            setAuthor("");
                            setEmail("");
                            setEmailCode("");
                            setTags([]);
                            setCover(null);
                            setImages([]);
                            editorRef.current.setMarkdown("# 请输入正文");
                        } else {
                            const text = await res.text();
                            alert("投稿失败: " + text);
                        }
                    } catch (err) {
                        console.error(err);
                        alert("网络请求失败，请检查连接或稍后重试。");
                    }
                }

                return (
                    <div>
                        <div className="main-layout">
                            <div className="card-section">
                                <div className="mb-3">
                                    <label className="form-label ">文章标题</label>
                                    <input type="text" className="form-control custom-border" value={title} onChange={e => setTitle(e.target.value)} />
                                </div>
                                <div className="mb-3">
                                    <label className="form-label">作者名</label>
                                    <input type="text" className="form-control custom-border" value={author} onChange={e => setAuthor(e.target.value)} />
                                </div>
                                <div className="mb-3">
                                    <label className="form-label">作者邮箱</label>
                                    <div className="email-group">
                                        <input type="email" className="form-control custom-border" value={email} onChange={e => setEmail(e.target.value)} />
                                        <button className="btn btn-outline-primary btn-sm blue-border" type="button" onClick={sendEmailCode}>发送验证码</button>
                                        <input type="text" className="form-control custom-border" placeholder="验证码" value={emailCode} onChange={e => setEmailCode(e.target.value)} />
                                        <button className="btn btn-outline-primary btn-sm blue-border" type="button" onClick={handleSubmit}>验证并提交</button>
                                    </div>
                                </div>

                                <div className="mb-3">
                                    <label className="form-label">标签</label>
                                    <input type="text" className="form-control custom-border" placeholder="输入后回车添加" onKeyDown={handleTagKeyDown} />
                                    <div className="mt-2">
                                        {tags.map(tag => (
                                            <span key={tag} className="tag">
                                        {tag} <span className="remove" onClick={() => removeTag(tag)}>&times;</span>
                                    </span>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-3">
                                    <label className="form-label">封面图</label>
                                    <input type="file" className="form-control custom-border" accept="image/*" onChange={handleCoverChange}/>
                                    {cover && (
                                        <div className="preview-img mt-2">
                                            <img src={`data:image/webp;base64,${cover.base64}`} alt="cover" /><br/>cover.webp
                                        </div>
                                    )}
                                </div>

                                <div className="mb-3">
                                    <label className="form-label">文章插图</label>
                                    <input type="file" className="form-control custom-border" accept="image/*" multiple onChange={handleImagesChange}/>
                                    <div className="mt-2 d-flex flex-wrap">
                                        {images.map(img => (
                                            <div key={img.name} className="preview-img">
                                                <img src={`data:image/webp;base64,${img.base64}`} alt={img.name}/>
                                                <div>{img.name}</div>
                                                <div className="img-btns">
                                                    <button className="btn btn-outline-primary btn-sm blue-border" onClick={() => insertImage(img.name)}>插入</button>
                                                    <button className="btn btn-outline-danger btn-sm red-border" onClick={() => removeImage(img.name)}>删除</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="guide">
                                <h5>投稿指南</h5>
                                <div>
                                    <strong>一、投稿前请确认</strong>
                                    <ul>
                                        <li>请务必在填写完所有内容后，再点击<strong>“发送验证码”</strong>与<strong>“验证并提交”</strong>提交投稿。</li>
                                        <li>文章标题将用作系统内的文件夹名称，例如：<code>./posts/我的文章</code></li>
                                    </ul>
                                </div>
                                <div>
                                    <strong>二、图片处理与插入</strong>
                                    <ul>
                                        <li>所有上传图片将自动转换为 <code>WebP</code> 格式。</li>
                                        <li>推荐：上传后点击“插入”按钮将图片添加到编辑器（预览区不显示属正常，不影响发布）。</li>
                                        <li>可选：直接复制粘贴插入图片（Base64 格式，可预览，但性能较差，不推荐）。</li>
                                    </ul>
                                </div>
                                <div>
                                    <strong>三、投稿与后续</strong>
                                    <ul>
                                        <li>点击“投稿”后，系统需要约 <strong>20秒</strong> 进行处理，请耐心等待，切勿重复点击，以免造成重复提交。</li>
                                        <li>投稿过程中如遇任何问题，请联系：<code>tsblydyzbjb@qidian.space</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div className="card-section">
                            <label className="form-label">正文</label>
                            <div id="editor"></div>
                        </div>
                    </div>
                );
            }

            // 渲染到 shadow DOM
            ReactDOM.createRoot(container).render(<App />);
        }, []);

        return <div ref={hostRef}></div>;
    }

    // 挂载 ShadowApp
    function initApp() {
        ReactDOM.createRoot(document.getElementById("app")).render(<ShadowApp />);
    }

    document.addEventListener("DOMContentLoaded", initApp);

    window.addEventListener("pjax:complete", initApp);

    ReactDOM.createRoot(document.getElementById("app")).render(<ShadowApp />);
</script>


</body>
</html>